interface Coordinates {
  lat: number;
  lng: number;
}

const UK_LOCATIONS: Record<string, Coordinates> = {
  "london": { lat: 51.5074, lng: -0.1278 },
  "central london": { lat: 51.5074, lng: -0.1278 },
  "east london": { lat: 51.5285, lng: -0.0216 },
  "west london": { lat: 51.5074, lng: -0.2654 },
  "north london": { lat: 51.5682, lng: -0.1187 },
  "south london": { lat: 51.4613, lng: -0.1156 },
  "manchester": { lat: 53.4808, lng: -2.2426 },
  "birmingham": { lat: 52.4862, lng: -1.8904 },
  "leeds": { lat: 53.8008, lng: -1.5491 },
  "sheffield": { lat: 53.3811, lng: -1.4701 },
  "liverpool": { lat: 53.4084, lng: -2.9916 },
  "bristol": { lat: 51.4545, lng: -2.5879 },
  "newcastle": { lat: 54.9783, lng: -1.6178 },
  "newcastle upon tyne": { lat: 54.9783, lng: -1.6178 },
  "nottingham": { lat: 52.9548, lng: -1.1581 },
  "leicester": { lat: 52.6369, lng: -1.1398 },
  "coventry": { lat: 52.4068, lng: -1.5197 },
  "cardiff": { lat: 51.4816, lng: -3.1791 },
  "edinburgh": { lat: 55.9533, lng: -3.1883 },
  "glasgow": { lat: 55.8642, lng: -4.2518 },
  "belfast": { lat: 54.5973, lng: -5.9301 },
  "brighton": { lat: 50.8225, lng: -0.1372 },
  "brighton and hove": { lat: 50.8225, lng: -0.1372 },
  "southampton": { lat: 50.9097, lng: -1.4044 },
  "portsmouth": { lat: 50.8198, lng: -1.0880 },
  "plymouth": { lat: 50.3755, lng: -4.1427 },
  "reading": { lat: 51.4543, lng: -0.9781 },
  "derby": { lat: 52.9225, lng: -1.4746 },
  "wolverhampton": { lat: 52.5870, lng: -2.1288 },
  "stoke-on-trent": { lat: 53.0027, lng: -2.1794 },
  "sunderland": { lat: 54.9069, lng: -1.3838 },
  "york": { lat: 53.9591, lng: -1.0815 },
  "oxford": { lat: 51.7520, lng: -1.2577 },
  "cambridge": { lat: 52.2053, lng: 0.1218 },
  "bath": { lat: 51.3758, lng: -2.3599 },
  "exeter": { lat: 50.7184, lng: -3.5339 },
  "norwich": { lat: 52.6309, lng: 1.2974 },
  "peterborough": { lat: 52.5695, lng: -0.2405 },
  "ipswich": { lat: 52.0567, lng: 1.1482 },
  "hull": { lat: 53.7457, lng: -0.3367 },
  "kingston upon hull": { lat: 53.7457, lng: -0.3367 },
  "milton keynes": { lat: 52.0406, lng: -0.7594 },
  "northampton": { lat: 52.2405, lng: -0.9027 },
  "luton": { lat: 51.8787, lng: -0.4200 },
  "swindon": { lat: 51.5558, lng: -1.7797 },
  "warwick": { lat: 52.2820, lng: -1.5849 },
  "worcester": { lat: 52.1936, lng: -2.2216 },
  "gloucester": { lat: 51.8642, lng: -2.2382 },
  "cheltenham": { lat: 51.8994, lng: -2.0783 },
  "chester": { lat: 53.1930, lng: -2.8931 },
  "lincoln": { lat: 53.2307, lng: -0.5406 },
  "carlisle": { lat: 54.8951, lng: -2.9382 },
  "durham": { lat: 54.7761, lng: -1.5733 },
  "aberdeen": { lat: 57.1497, lng: -2.0943 },
  "dundee": { lat: 56.4620, lng: -2.9707 },
  "inverness": { lat: 57.4778, lng: -4.2247 },
  "stirling": { lat: 56.1165, lng: -3.9369 },
  "swansea": { lat: 51.6214, lng: -3.9436 },
  "newport": { lat: 51.5842, lng: -2.9977 },
  "loughborough": { lat: 52.7721, lng: -1.2063 },
  "guildford": { lat: 51.2362, lng: -0.5704 },
  "maidstone": { lat: 51.2720, lng: 0.5290 },
  "colchester": { lat: 51.8860, lng: 0.8919 },
  "chelmsford": { lat: 51.7356, lng: 0.4685 },
  "basildon": { lat: 51.5762, lng: 0.4886 },
  "southend-on-sea": { lat: 51.5459, lng: 0.7077 },
  "watford": { lat: 51.6565, lng: -0.3903 },
  "hemel hempstead": { lat: 51.7530, lng: -0.4486 },
  "st albans": { lat: 51.7553, lng: -0.3360 },
  "slough": { lat: 51.5084, lng: -0.5951 },
  "harrogate": { lat: 53.9921, lng: -1.5418 },
  "scarborough": { lat: 54.2790, lng: -0.4050 },
  "blackpool": { lat: 53.8142, lng: -3.0503 },
  "preston": { lat: 53.7632, lng: -2.7031 },
  "lancaster": { lat: 54.0466, lng: -2.8007 },
  "bolton": { lat: 53.5785, lng: -2.4299 },
  "wigan": { lat: 53.5461, lng: -2.6325 },
  "stockport": { lat: 53.4106, lng: -2.1575 },
  "oldham": { lat: 53.5409, lng: -2.1114 },
  "rochdale": { lat: 53.6097, lng: -2.1561 },
  "burnley": { lat: 53.7893, lng: -2.2484 },
  "huddersfield": { lat: 53.6458, lng: -1.7850 },
  "wakefield": { lat: 53.6833, lng: -1.4977 },
  "halifax": { lat: 53.7216, lng: -1.8596 },
  "bradford": { lat: 53.7960, lng: -1.7594 },
  "doncaster": { lat: 53.5228, lng: -1.1285 },
  "rotherham": { lat: 53.4326, lng: -1.3635 },
  "barnsley": { lat: 53.5529, lng: -1.4793 },
  "grimsby": { lat: 53.5675, lng: -0.0760 },
  "scunthorpe": { lat: 53.5810, lng: -0.6550 },
  "mansfield": { lat: 53.1395, lng: -1.1987 },
  "chesterfield": { lat: 53.2350, lng: -1.4210 },
  "telford": { lat: 52.6766, lng: -2.4469 },
  "shrewsbury": { lat: 52.7077, lng: -2.7544 },
  "hereford": { lat: 52.0565, lng: -2.7160 },
  "stafford": { lat: 52.8071, lng: -2.1172 },
  "burton upon trent": { lat: 52.8023, lng: -1.6291 },
  "tamworth": { lat: 52.6337, lng: -1.6914 },
  "nuneaton": { lat: 52.5234, lng: -1.4684 },
  "rugby": { lat: 52.3702, lng: -1.2615 },
  "leamington spa": { lat: 52.2919, lng: -1.5358 },
  "stratford-upon-avon": { lat: 52.1917, lng: -1.7083 },
  "banbury": { lat: 52.0629, lng: -1.3397 },
  "kettering": { lat: 52.3989, lng: -0.7230 },
  "corby": { lat: 52.4882, lng: -0.6927 },
  "wellingborough": { lat: 52.3024, lng: -0.6939 },
  "bedford": { lat: 52.1356, lng: -0.4682 },
  "aylesbury": { lat: 51.8168, lng: -0.8084 },
  "high wycombe": { lat: 51.6293, lng: -0.7482 },
  "maidenhead": { lat: 51.5217, lng: -0.7177 },
  "windsor": { lat: 51.4846, lng: -0.6044 },
  "basingstoke": { lat: 51.2667, lng: -1.0876 },
  "winchester": { lat: 51.0632, lng: -1.3080 },
  "salisbury": { lat: 51.0688, lng: -1.7945 },
  "bournemouth": { lat: 50.7192, lng: -1.8808 },
  "poole": { lat: 50.7151, lng: -1.9870 },
  "dorchester": { lat: 50.7136, lng: -2.4386 },
  "taunton": { lat: 51.0152, lng: -3.1030 },
  "yeovil": { lat: 50.9452, lng: -2.6371 },
  "weston-super-mare": { lat: 51.3469, lng: -2.9767 },
  "torquay": { lat: 50.4619, lng: -3.5253 },
  "truro": { lat: 50.2632, lng: -5.0510 },
  "barnstaple": { lat: 51.0798, lng: -4.0619 },
  "weymouth": { lat: 50.6144, lng: -2.4572 },
  "worthing": { lat: 50.8148, lng: -0.3722 },
  "eastbourne": { lat: 50.7684, lng: 0.2905 },
  "hastings": { lat: 50.8554, lng: 0.5730 },
  "ashford": { lat: 51.1465, lng: 0.8746 },
  "canterbury": { lat: 51.2802, lng: 1.0789 },
  "margate": { lat: 51.3813, lng: 1.3862 },
  "folkestone": { lat: 51.0816, lng: 1.1691 },
  "dover": { lat: 51.1295, lng: 1.3089 },
  "tunbridge wells": { lat: 51.1322, lng: 0.2634 },
  "crawley": { lat: 51.1092, lng: -0.1872 },
  "horsham": { lat: 51.0620, lng: -0.3254 },
  "chichester": { lat: 50.8365, lng: -0.7792 },
  "croydon": { lat: 51.3762, lng: -0.0982 },
  "kingston upon thames": { lat: 51.4085, lng: -0.3064 },
  "richmond": { lat: 51.4613, lng: -0.3037 },
  "woolwich": { lat: 51.4907, lng: 0.0693 },
  "romford": { lat: 51.5754, lng: 0.1827 },
  "ilford": { lat: 51.5588, lng: 0.0753 },
  "barking": { lat: 51.5363, lng: 0.0808 },
  "enfield": { lat: 51.6524, lng: -0.0824 },
  "harrow": { lat: 51.5786, lng: -0.3375 },
  "ealing": { lat: 51.5133, lng: -0.3087 },
  "wembley": { lat: 51.5560, lng: -0.2795 },
  "brentford": { lat: 51.4867, lng: -0.3089 },
  "stratford": { lat: 51.5411, lng: -0.0006 },
  "greenwich": { lat: 51.4769, lng: -0.0005 },
  "lewisham": { lat: 51.4535, lng: -0.0205 },
  "bromley": { lat: 51.4039, lng: 0.0198 },
  "sutton": { lat: 51.3618, lng: -0.1945 },
  "wimbledon": { lat: 51.4214, lng: -0.2064 },
  "hammersmith": { lat: 51.4928, lng: -0.2229 },
  "kensington": { lat: 51.4990, lng: -0.1939 },
  "westminster": { lat: 51.4975, lng: -0.1357 },
  "islington": { lat: 51.5362, lng: -0.1033 },
  "camden": { lat: 51.5290, lng: -0.1255 },
  "hackney": { lat: 51.5450, lng: -0.0553 },
  "tower hamlets": { lat: 51.5150, lng: -0.0340 },
  "southwark": { lat: 51.5035, lng: -0.0804 },
  "lambeth": { lat: 51.4571, lng: -0.1231 },
  "wandsworth": { lat: 51.4571, lng: -0.1818 },
  "leicestershire": { lat: 52.6369, lng: -1.1398 },
  "east midlands": { lat: 52.8300, lng: -1.3300 },
  "west midlands": { lat: 52.4862, lng: -1.8904 },
  "west yorkshire": { lat: 53.7960, lng: -1.7594 },
  "south yorkshire": { lat: 53.3811, lng: -1.4701 },
  "greater manchester": { lat: 53.4808, lng: -2.2426 },
  "merseyside": { lat: 53.4084, lng: -2.9916 },
  "tyne and wear": { lat: 54.9783, lng: -1.6178 },
  "hampshire": { lat: 51.0577, lng: -1.3081 },
  "kent": { lat: 51.2787, lng: 0.5217 },
  "surrey": { lat: 51.2413, lng: -0.5714 },
  "essex": { lat: 51.7343, lng: 0.4691 },
  "hertfordshire": { lat: 51.8098, lng: -0.2377 },
  "buckinghamshire": { lat: 51.8137, lng: -0.8095 },
  "oxfordshire": { lat: 51.7520, lng: -1.2577 },
  "berkshire": { lat: 51.4543, lng: -0.9781 },
  "wiltshire": { lat: 51.3492, lng: -1.9927 },
  "dorset": { lat: 50.7488, lng: -2.3445 },
  "devon": { lat: 50.7156, lng: -3.5309 },
  "cornwall": { lat: 50.2660, lng: -5.0527 },
  "somerset": { lat: 51.1046, lng: -2.9262 },
  "suffolk": { lat: 52.1872, lng: 1.0042 },
  "norfolk": { lat: 52.6140, lng: 0.8864 },
  "cambridgeshire": { lat: 52.2053, lng: 0.1218 },
  "bedfordshire": { lat: 52.1356, lng: -0.4682 },
  "northamptonshire": { lat: 52.2405, lng: -0.9027 },
  "warwickshire": { lat: 52.2820, lng: -1.5849 },
  "staffordshire": { lat: 52.8793, lng: -2.0572 },
  "shropshire": { lat: 52.6766, lng: -2.4469 },
  "derbyshire": { lat: 53.1000, lng: -1.5600 },
  "nottinghamshire": { lat: 53.1000, lng: -1.1500 },
  "lincolnshire": { lat: 53.2307, lng: -0.5406 },
  "lancashire": { lat: 53.7632, lng: -2.7031 },
  "cumbria": { lat: 54.5773, lng: -2.7975 },
  "county durham": { lat: 54.7761, lng: -1.5733 },
  "northumberland": { lat: 55.2083, lng: -2.0784 },
  "east sussex": { lat: 50.9086, lng: 0.2494 },
  "west sussex": { lat: 50.8360, lng: -0.4578 },
  "gloucestershire": { lat: 51.8642, lng: -2.2382 },
  "worcestershire": { lat: 52.1936, lng: -2.2216 },
  "herefordshire": { lat: 52.0565, lng: -2.7160 },
  "north yorkshire": { lat: 54.1432, lng: -1.5237 },
  "east yorkshire": { lat: 53.8430, lng: -0.4278 },
  "scotland": { lat: 56.4907, lng: -4.2026 },
  "wales": { lat: 52.1307, lng: -3.7837 },
  "northern ireland": { lat: 54.6078, lng: -5.9260 },
  "isle of wight": { lat: 50.6938, lng: -1.3048 },
  "jersey": { lat: 49.2144, lng: -2.1312 },
  "guernsey": { lat: 49.4482, lng: -2.5895 },
};

export function getCoordinates(location: string): Coordinates | null {
  const normalized = location.trim().toLowerCase();
  if (UK_LOCATIONS[normalized]) {
    return UK_LOCATIONS[normalized];
  }
  for (const [key, coords] of Object.entries(UK_LOCATIONS)) {
    if (normalized.includes(key) || key.includes(normalized)) {
      return coords;
    }
  }
  return null;
}

export function calculateDistanceKm(coord1: Coordinates, coord2: Coordinates): number {
  const R = 6371;
  const dLat = toRad(coord2.lat - coord1.lat);
  const dLng = toRad(coord2.lng - coord1.lng);
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(toRad(coord1.lat)) * Math.cos(toRad(coord2.lat)) *
    Math.sin(dLng / 2) * Math.sin(dLng / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

function toRad(deg: number): number {
  return deg * (Math.PI / 180);
}

export function isWithinRadius(
  locationA: string,
  locationB: string,
  radiusKm: number
): boolean | null {
  const coordA = getCoordinates(locationA);
  const coordB = getCoordinates(locationB);
  if (!coordA || !coordB) {
    return null;
  }
  const distance = calculateDistanceKm(coordA, coordB);
  return distance <= radiusKm;
}
